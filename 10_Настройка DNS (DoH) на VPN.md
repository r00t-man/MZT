# üåê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DoH (DNS-over-HTTPS)

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ DoH –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ —Ç—Ä–µ–±—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç DoT).  
–ü–æ—ç—Ç–æ–º—É –ø–µ—Ä–≤—ã–º –¥–µ–ª–æ–º —É—Å—Ç–∞–Ω–æ–≤–∏–º –∏ –Ω–∞—Å—Ç—Ä–æ–∏–º **dnscrypt-proxy** –≤–µ—Ä—Å–∏–∏ **2.0.45** ‚Äî –æ–Ω–∞ —Å—Ç–∞–±–∏–ª—å–Ω–∞ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞, –∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∫ –≤–µ—Ä—Å–∏–∏.

---

## ‚öôÔ∏è **1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ dnscrypt-proxy**

```bash
sudo apt update
sudo apt install curl wget unzip -y
wget https://github.com/DNSCrypt/dnscrypt-proxy/releases/download/2.0.45/dnscrypt-proxy-linux_x86_64-2.0.45.tar.gz
tar -xvzf dnscrypt-proxy-linux_x86_64-2.0.45.tar.gz
sudo mv linux-x86_64 /usr/local/dnscrypt-proxy
sudo ln -s /usr/local/dnscrypt-proxy/dnscrypt-proxy /usr/sbin/dnscrypt-proxy
````

---

## üë§ **2. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

```bash
sudo useradd -r -s /usr/sbin/nologin -d /var/cache/dnscrypt-proxy _dnscrypt-proxy
```

---

## üìÅ **3. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏ –ø—Ä–∞–≤–∞**

```bash
sudo mkdir -p /var/cache/dnscrypt-proxy /var/log/dnscrypt-proxy /run/dnscrypt-proxy /etc/dnscrypt-proxy
sudo chown -R _dnscrypt-proxy:_dnscrypt-proxy /var/cache/dnscrypt-proxy /var/log/dnscrypt-proxy /run/dnscrypt-proxy
```

---

## üß© **4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è dnscrypt-proxy**

–§–∞–π–ª: `/etc/dnscrypt-proxy/dnscrypt-proxy.toml`

```toml
listen_addresses = ['127.0.0.1:5353']

# –í–µ—Ä—Å–∏—è: stable-2025.10.25-gisoman

## nscrypt-proxy —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ localhost:5353, –∞ –Ω–µ –Ω–∞ 53 –ø–æ—Ä—Ç—É.
## –≠—Ç–æ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å systemd-resolved.

# –õ–æ–≥–∏
log_file = '/var/log/dnscrypt-proxy/dnscrypt-proxy.log'
log_level = 2

# –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ DoH
ipv4_servers = true
ipv6_servers = false
dnscrypt_servers = false
doh_servers = true

# –ü–æ–¥–∫–ª—é—á–∞–µ—à—å—Å—è —Ç–æ–ª—å–∫–æ –∫ DoH-—Å–µ—Ä–≤–µ—Ä–∞–º (DNS-over-HTTPS), –Ω–µ –∫ —Å—Ç–∞—Ä—ã–º DNSCrypt.
# –≠—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –±–æ–ª–µ–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å–ø–æ—Å–æ–± —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è DNS.

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
require_dnssec = false
require_nolog = false
require_nofilter = false

# –ù–µ —Ç—Ä–µ–±—É–µ—à—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ DNSSEC, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ª–æ–≥–æ–≤ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
# –ì–∏–±–∫–∏–π –ø–æ–¥—Ö–æ–¥: –º—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä—ã –∏–∑-–∑–∞ –æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, –Ω–æ –¥–æ–≤–µ—Ä—è–µ–º –Ω–∞—à–µ–º—É DNS vashdnsdomen.

# –°–µ—Ä–≤–µ—Ä—ã –≤—Ä—É—á–Ω—É—é
server_names = ['vashdnsdomen']
fallback_resolvers = ['1.1.1.1:53', '8.8.8.8:53']

# –û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–µ—Ä ‚Äî —Ç–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π vashdnsdomen.ru —á–µ—Ä–µ–∑ DoH.
# –ï—Å–ª–∏ –æ–Ω –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Äî fallback –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–µ DNS (Cloudflare, Google), –Ω–æ –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è (—ç—Ç–æ –æ–±—ã—á–Ω—ã–π UDP-DNS).
# –ù–∏–∂–µ –ø–æ—è—Å–Ω–µ–Ω–∏–µ –¥–ª—è —á–µ–≥–æ –Ω–∞–º fallback_resolvers

# –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä
[static.'vashdnsdomen']
stamp = 'sdns://BfeAAAADDSASWAANd1tsZG4sLnJ1OjG0MwovDG5vLXF1TDJ3'

# –†—É—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞ —á–µ—Ä–µ–∑ DNS Stamp ‚Äî —ç—Ç–æ –∫–∞–∫ QR-–∫–æ–¥ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ DNS.
# –£–∫–∞–∑—ã–≤–∞–µ—Ç: ¬´–ü–æ–¥–∫–ª—é—á–∞–π—Å—è –∫ vashdnsdomen.ru:443 –ø–æ DoH –∏ –∏—Å–ø–æ–ª—å–∑—É–π —ç—Ç–æ—Ç –ø—É—Ç—å /dns-query¬ª.
# –¢–∞–∫ —Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—à—å —Å–≤–æ–π DNS –∏ –º–æ–∂–µ—à—å —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å —Ä–µ–∫–ª–∞–º—É —á–µ—Ä–µ–∑ AdGuard.

# ‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º:
# fallback_resolvers = ['1.1.1.1:53', '8.8.8.8:53']
# 
# –¢–∞–∫ –∂–µ –º—ã —É–∫–∞–∑—ã–≤–∞–µ–º –≤ –∫–æ–Ω—Ñ–∏–≥–µ:
# [static.'vashdnsdomen']
# stamp = 'sdns://Agc...vashdnsdomen.ru:443/dns-query'
# –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç: ¬´–ü–æ–¥–∫–ª—é—á–∞–π—Å—è –∫ vashdnsdomen.ru –ø–æ HTTPS –∏ –¥–µ–ª–∞–π –∑–∞–ø—Ä–æ—Å—ã —Ç–∞–º¬ª.
# –ù–æ –ø–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ HTTPS, dnscrypt-proxy –¥–æ–ª–∂–µ–Ω:
# –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∏–º—è vashdnsdomen.ru ‚Üí –≤ IP-–∞–¥—Ä–µ—Å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 94.183.234.239).
# –ê –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–µ–Ω –æ–±—ã—á–Ω—ã–π DNS-–∑–∞–ø—Ä–æ—Å ‚Äî "–∫–∞–∫–æ–π IP —É vashdnsdomen.ru?".
# ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞:
# –°–∞–º dnscrypt-proxy –µ—â—ë –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π DNS, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω –µ—â—ë –Ω–µ –ø–æ–¥–∫–ª—é—á—ë–Ω.
# –û–Ω –∫–∞–∫ –±—ã "–∑–∞—Å—Ç—Ä—è–ª –≤ –∫—Ä—É–≥–µ":
# –ß—Ç–æ–±—ã –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ DoH, –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å IP ‚Üí –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å IP, –Ω—É–∂–µ–Ω DNS ‚Üí –ê DNS –ø–æ–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç‚Ä¶ 
# –í–æ—Ç —Ç—É—Ç –∏ –Ω—É–∂–µ–Ω fallback_resolver:
# –≠—Ç–æ "—Å–ø–∞—Å–∞—Ç–µ–ª—å–Ω—ã–π" DNS-—Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ —Å—Ç–∞—Ä–∏–Ω–∫–µ, —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π UDP/53, –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.
# dnscrypt-proxy —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É –Ω–µ–≥–æ: ¬´–≠–π, –∞ –∫–∞–∫–æ–π IP —É vashdnsdomen.ru?¬ª
# –ü–æ–ª—É—á–∏–≤ –æ—Ç–≤–µ—Ç, –æ–Ω —É–∂–µ –º–æ–∂–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞—â–∏—â—ë–Ω–Ω–æ–µ HTTPS-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å vashdnsdomen.ru –∏ –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DoH.
```

üí° *–ß—Ç–æ –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:*

* `listen_addresses = ['127.0.0.1:5353']` ‚Äî —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ª–æ–∫–∞–ª—å–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å `systemd-resolved`.
* `fallback_resolvers` –Ω—É–∂–Ω—ã, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å IP —Ç–≤–æ–µ–≥–æ –¥–æ–º–µ–Ω–∞ **–¥–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è DoH-—Å–µ—Å—Å–∏–∏**.
* `stamp` ‚Äî —ç—Ç–æ "–ø–æ–¥–ø–∏—Å—å" DNS-—Å–µ—Ä–≤–µ—Ä–∞ (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é, —Å–º. –Ω–∏–∂–µ).

üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°
## –í–æ—Ç –≤–∞–º —Ä–∞–±–æ—á–∏–π –∫–æ–Ω—Ñ–∏–≥ –Ω–∞ DoH AdGuard –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π:üí°
üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°
```bash
nano /etc/dnscrypt-proxy/dnscrypt-proxy.toml
```

```toml
listen_addresses = ['127.0.0.1:5353']

# –í–µ—Ä—Å–∏—è: stable-2025.10.25-gisoman

## nscrypt-proxy —Å–ª—É—à–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ localhost:5353, –∞ –Ω–µ –Ω–∞ 53 –ø–æ—Ä—Ç—É.
## –≠—Ç–æ –≤–∞–∂–Ω–æ, —á—Ç–æ–±—ã –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤–∞—Ç—å —Å systemd-resolved.

# –õ–æ–≥–∏
log_file = '/var/log/dnscrypt-proxy/dnscrypt-proxy.log'
log_level = 2

# –†–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ DoH
ipv4_servers = true
ipv6_servers = false
dnscrypt_servers = false
doh_servers = true

# –ü–æ–¥–∫–ª—é—á–∞–µ—à—å—Å—è —Ç–æ–ª—å–∫–æ –∫ DoH-—Å–µ—Ä–≤–µ—Ä–∞–º (DNS-over-HTTPS), –Ω–µ –∫ —Å—Ç–∞—Ä—ã–º DNSCrypt.
# –≠—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –∏ –±–æ–ª–µ–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å–ø–æ—Å–æ–± —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è DNS.

# –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
require_dnssec = false
require_nolog = false
require_nofilter = false

# –ù–µ —Ç—Ä–µ–±—É–µ—à—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–≥–æ DNSSEC, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ª–æ–≥–æ–≤ –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
# –ì–∏–±–∫–∏–π –ø–æ–¥—Ö–æ–¥: –º—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä—ã –∏–∑-–∑–∞ –æ–¥–Ω–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, –Ω–æ –¥–æ–≤–µ—Ä—è–µ–º –Ω–∞—à–µ–º—É DNS vashdnsdomen.

# –°–µ—Ä–≤–µ—Ä—ã –≤—Ä—É—á–Ω—É—é

server_names = ['dns.adguard-dns']

fallback_resolvers = ['1.1.1.1:53', '8.8.8.8:53']

[static.'dns.adguard-dns']
stamp = 'sdns://AgcAAAAAAAAAAAAXZG5zLmFkZ3VhcmQtZG5zLmNvbTo0NDMKL2Rucy1xdWVyeQ'
```
üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°üí°

---

## üßæ **5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è DNS Stamp**

–ü–µ—Ä–µ–π–¥–∏ –Ω–∞ —Å–∞–π—Ç [dnscrypt.info/stamps](https://dnscrypt.info/stamps/)

1. –í–≤–µ–¥–∏ —Å–≤–æ–π –¥–æ–º–µ–Ω —Å –ø–æ—Ä—Ç–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä: `vashdnsdomen.ru:443`)
2. –ü—É—Ç—å: `/dns-query`
3. –°–∫–æ–ø–∏—Ä—É–π –≥–æ—Ç–æ–≤—ã–π stamp –∏ –≤—Å—Ç–∞–≤—å –µ–≥–æ –≤ –∫–æ–Ω—Ñ–∏–≥ –≤—ã—à–µ.

üì∏ *–ü—Ä–∏–º–µ—Ä:*

![stamp-example](https://github.com/soulpastwk/share/blob/main/media/vpn00/stamp.png)

---

## üîß **6. Systemd-—Å–µ—Ä–≤–∏—Å**

–§–∞–π–ª: `/usr/lib/systemd/system/dnscrypt-proxy.service`

```ini
[Unit]
Description=DNSCrypt client proxy
Documentation=https://github.com/DNSCrypt/dnscrypt-proxy/wiki
After=network.target
Before=nss-lookup.target
Wants=nss-lookup.target

[Service]
User=_dnscrypt-proxy
Group=_dnscrypt-proxy
WorkingDirectory=/var/cache/dnscrypt-proxy
ExecStart=/usr/sbin/dnscrypt-proxy -config /etc/dnscrypt-proxy/dnscrypt-proxy.toml

ProtectHome=false
ProtectKernelModules=false
ProtectKernelTunables=false
ProtectControlGroups=false
MemoryDenyWriteExecute=false
NoNewPrivileges=false

CacheDirectory=dnscrypt-proxy
LogsDirectory=dnscrypt-proxy
RuntimeDirectory=dnscrypt-proxy
RuntimeDirectoryMode=0755

Restart=on-failure

[Install]
WantedBy=multi-user.target
```

---

## üß† **7. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd-resolved**

–§–∞–π–ª: `/etc/systemd/resolved.conf`

```ini
[Resolve]
DNS=127.0.0.1:5353
DNSSEC=no
DNSOverTLS=no
Cache=no
MulticastDNS=no
LLMNR=no

# –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç:
# ‚úÖ DNS=127.0.0.1:5353
# –ì–æ–≤–æ—Ä–∏—Ç systemd-resolved: ¬´–í—Å–µ DNS-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è–π –≤ dnscrypt-proxy¬ª.
# –≠—Ç–æ –≥–ª–∞–≤–Ω—ã–π –º–æ—Å—Ç –º–µ–∂–¥—É —Å–∏—Å—Ç–µ–º–æ–π –∏ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–º DNS.
# ‚úÖ DNSSEC=no
# –ù–µ –≤–∫–ª—é—á–∞–µ—à—å –ø—Ä–æ–≤–µ—Ä–∫—É DNSSEC –Ω–∞ —É—Ä–æ–≤–Ω–µ resolved.
# –õ–æ–≥–∏—á–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –º—ã –Ω–µ –≤–∫–ª—é—á–∞–µ–º require_dnssec –≤ dnscrypt-proxy.
# –ï—Å–ª–∏ –±—ã –≤–∫–ª—é—á–∏–ª–∏ ‚Äî –º–æ–≥ –ª–∏ –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DNSSEC=yes + trust-ad –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ.
# –ù–æ –ø–æ —Ñ–∞–∫—Ç—É DNSSEC —Ä–µ–¥–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.
# ‚úÖ DNSOverTLS=no
# –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º DoT, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–∞—Å DoH —á–µ—Ä–µ–∑ dnscrypt-proxy ‚Äî —ç—Ç–æ –ª—É—á—à–µ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–µ–µ.
# DoH –∏ DoT ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã, –º—ã –≤—ã–±—Ä–∞–ª–∏ DoH, —Ç.–∫. DoT –º–æ–≥—É—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ –ø–æ—Ä—Ç—É 853, –∞ DoH —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 443.
# ‚úÖ Cache=no
# –û—Ç–∫–ª—é—á–∞–µ–º –∫–µ—à DNS –≤ resolved.
# –ó–∞—á–µ–º? –ß—Ç–æ–±—ã –≤—Å—ë –ø—Ä–æ—Ö–æ–¥–∏–ª–æ —á–µ—Ä–µ–∑ dnscrypt-proxy, –≥–¥–µ, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –∫–µ—à —É–∂–µ –µ—Å—Ç—å.
# –ü–æ–ª–µ–∑–Ω–æ, –µ—Å–ª–∏ —Ö–æ—Ç–∏–º —á–∏—Å—Ç—ã–µ —Ç–µ—Å—Ç—ã –∏–ª–∏ –æ–±—Ö–æ–¥ –∫–µ—à–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö.
# ‚úÖ MulticastDNS=no, LLMNR=no
# –û—Ç–∫–ª—é—á–∞–µ—à—å –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ç–æ–∫–æ–ª—ã –ø–æ–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤ —Å–µ—Ç–∏.
# –≠—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –º–µ–Ω—å—à–µ –≤–µ–∫—Ç–æ—Ä–æ–≤ –∞—Ç–∞–∫ –∏ —Å–ø—É—Ñ–∏–Ω–≥–∞.
# –û—Å–æ–±–µ–Ω–Ω–æ –∞–∫—Ç—É–∞–ª—å–Ω–æ, –µ—Å–ª–∏ –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º .local –∏–º–µ–Ω–∞.
```

üí¨ *–ó–∞—á–µ–º —Ç–∞–∫:*

* `DNS=127.0.0.1:5353` ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ DNS-–∑–∞–ø—Ä–æ—Å—ã –≤ `dnscrypt-proxy`.
* `DNSOverTLS=no` ‚Äî –Ω–µ –Ω—É–∂–µ–Ω, —Ç.–∫. –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DoH.
* `Cache=no` ‚Äî –æ—Ç–∫–ª—é—á–∞–µ–º –∫—ç—à systemd, —á—Ç–æ–±—ã –≤—Å—ë —à–ª–æ —á–µ—Ä–µ–∑ dnscrypt-proxy.
* `MulticastDNS` –∏ `LLMNR` –æ—Ç–∫–ª—é—á–µ–Ω—ã –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

---

## üß± **8. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ resolv.conf**

–§–∞–π–ª: `/etc/resolv.conf`

```ini
nameserver 127.0.0.53
options edns0 trust-ad
search .

# –ß—Ç–æ —ç—Ç–æ –∑–Ω–∞—á–∏—Ç:
# ‚úÖ nameserver 127.0.0.53
# –≠—Ç–æ –∞–¥—Ä–µ—Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ DNS-—Ä–µ–∑–æ–ª–≤–µ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç systemd-resolved.
# –ù–µ —É–∫–∞–∑—ã–≤–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é Cloudflare –∏–ª–∏ Google ‚Äî –≤–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–∞ (resolved).
# –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –±—É—Ñ–µ—Ä: –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –æ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –∏—Ö –¥–∞–ª—å—à–µ (—É –Ω–∞—Å –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ dnscrypt-proxy).
# –ü–æ—á–µ–º—É –Ω–µ 127.0.0.1? –ü–æ—Ç–æ–º—É —á—Ç–æ 127.0.0.53 ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∞–¥—Ä–µ—Å –¥–ª—è systemd-resolved, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ –æ–Ω –∑–∞–ø—É—â–µ–Ω –≤ —Ä–µ–∂–∏–º–µ stub resolver. 
# 
# ‚úÖ options edns0 trust-ad
# edns0 ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ DNS, –ø–æ–∑–≤–æ–ª—è—é—â–µ–µ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –±–æ–ª—å—à–µ –¥–∞–Ω–Ω—ã—Ö –≤ –æ–¥–Ω–æ–º –ø–∞–∫–µ—Ç–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ DNSSEC).
# trust-ad ‚Äî –¥–æ–≤–µ—Ä—è–π —Ñ–ª–∞–≥—É "AD" (Authenticated Data) –æ—Ç –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∑–æ–ª–≤–µ—Ä–∞.
# –§–ª–∞–≥ AD –æ–∑–Ω–∞—á–∞–µ—Ç: ¬´–æ—Ç–≤–µ—Ç –ø—Ä–æ—à—ë–ª –ø—Ä–æ–≤–µ—Ä–∫—É DNSSEC –∏ –ø–æ–¥–ª–∏–Ω–Ω—ã–π¬ª.
# –ú—ã –≥–æ–≤–æ—Ä–∏–º —Å–∏—Å—Ç–µ–º–µ: ¬´–ï—Å–ª–∏ resolved —Å–∫–∞–∑–∞–ª, —á—Ç–æ –æ—Ç–≤–µ—Ç –∑–∞—â–∏—â—ë–Ω DNSSEC ‚Äî —è –≤–µ—Ä—é –µ–º—É¬ª, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∞–º –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª.
# ‚ö†Ô∏è –í dnscrypt-proxy —Å—Ç–æ–∏—Ç require_dnssec = false, –∑–Ω–∞—á–∏—Ç, –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ DNSSEC –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Å—Ç—Ä–æ–≥–æ, –∏ trust-ad –∑–¥–µ—Å—å –±–µ–∑–æ–ø–∞—Å–µ–Ω.
# 
# ‚úÖ search .
# –û—Ç–∫–ª—é—á–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –¥–æ–º–µ–Ω–∞–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
# –ë–µ–∑ —ç—Ç–æ–≥–æ, –µ—Å–ª–∏ –º—ã –≤—ã–ø–æ–ª–Ω–∏–º ping server, —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å server.local, server.home –∏ —Ç.–¥.
# –ú—ã —Å–∫–∞–∑–∞–ª–∏: ¬´–ù–µ –¥–æ–±–∞–≤–ª—è–π –Ω–∏—á–µ–≥–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–ª–Ω—ã–µ –∏–º–µ–Ω–∞¬ª.
```

üí¨ *–ü–æ—è—Å–Ω–µ–Ω–∏–µ:*

* `127.0.0.53` ‚Äî –∞–¥—Ä–µ—Å `systemd-resolved`, –æ–Ω –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ dnscrypt-proxy.
* `trust-ad` ‚Äî –¥–æ–≤–µ—Ä–∏–µ —Ñ–ª–∞–≥—É DNSSEC.
* `search .` ‚Äî –æ—Ç–∫–ª—é—á–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–º–µ–Ω–æ–≤.

–ü—Ä–∏–º–µ–Ω—è–µ–º:

```bash
sudo systemctl restart systemd-resolved
```

---

## üöÄ **9. –ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–ª—É–∂–±—ã**

```bash
sudo systemctl daemon-reload
sudo systemctl enable dnscrypt-proxy
sudo systemctl start dnscrypt-proxy
sudo systemctl status dnscrypt-proxy
```

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏:

```bash
tail -f /var/log/dnscrypt-proxy/dnscrypt-proxy.log
```

---

## üîç **10. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã**

```bash
dig @127.0.0.1 -p 5353 www.google.com
curl -vk https://vashdnsdomen.ru/dns-query
```

‚úÖ –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç—ã –ø—Ä–∏—Ö–æ–¥—è—Ç ‚Äî –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

---

## üì± **11. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞—Ö**

* üíª **–†–æ—É—Ç–µ—Ä** ‚Äî —É–∫–∞–∑—ã–≤–∞–µ–º DoH-—Å–µ—Ä–≤–µ—Ä `https://vashdnsdomen.ru/dns-query`
* üì± **Android** ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º *–ß–∞—Å—Ç–Ω—ã–π DNS* ‚Üí `vashdnsdomen.ru` (—Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ DoT)
* üß† **–°–æ–≤–µ—Ç:** –¥–µ—Ä–∂–∏ –æ–±–∞ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ (DoH –∏ DoT) –∞–∫—Ç–∏–≤–Ω—ã–º–∏ ‚Äî —ç—Ç–æ —É–ª—É—á—à–∞–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å.

---

### üß© **–ò—Ç–æ–≥:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç            | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   | –ü—Ä–æ—Ç–æ–∫–æ–ª      |
| -------------------- | ---------------------------- | ------------- |
| `dnscrypt-proxy`     | –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π DNS | DoH           |
| `systemd-resolved`   | –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∑–æ–ª–≤–µ—Ä           | DNS stub      |
| `resolv.conf`        | –ü—Ä–æ–∫—Å–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π        | –ª–æ–∫–∞–ª—å–Ω—ã–π DNS |
| `fallback_resolvers` | –†–µ–∑–µ—Ä–≤–Ω—ã–π –ø—É—Ç—å               | UDP/53        |

---

> ‚ú® –¢–µ–ø–µ—Ä—å —Ç–≤–æ–π —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π, –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –∏ —É—Å—Ç–æ–π—á–∏–≤—ã–π –∫ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º DNS —á–µ—Ä–µ–∑ HTTPS**.
>
> üîí –ë–µ–∑ —É—Ç–µ—á–µ–∫, –±–µ–∑ –∫—ç—à–µ–π, —Å –ø–æ–ª–Ω—ã–º –∫–æ–Ω—Ç—Ä–æ–ª–µ–º —Ç—Ä–∞—Ñ–∏–∫–∞.

—á—Ç–æ–±—ã –≤—Å—ë –≤—ã–≥–ª—è–¥–µ–ª–æ –∫–∞–∫ –µ–¥–∏–Ω–∞—è —Å–µ—Ä–∏—è –≥–∞–π–¥–æ–≤?
```
